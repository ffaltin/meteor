!function(e,o,i){"use strict";function t(e){$.iterate.call(j,v)}function a(){j=e(w.base)}function r(o){o.youTubeGuid=0,o.$container=e('<div class="'+P.container+'"></div>').appendTo(this),this.addClass([P.base,o.customClass].join(" "));var i=o.source;o.source=null,s(o,i,!0),a()}function n(e){e.$container.remove(),this.removeClass([P.base,e.customClass].join(" ")).off(T.namespace),a()}function s(o,i,t){if(i!==o.source){if(o.source=i,o.responsive=!1,o.isYouTube=!1,"object"===e.type(i)&&"string"===e.type(i.video)){var a=i.video.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);a&&a.length>=1&&(o.isYouTube=!0,o.videoId=a[1])}var r=!o.isYouTube&&"object"===e.type(i)&&(i.hasOwnProperty("mp4")||i.hasOwnProperty("ogg")||i.hasOwnProperty("webm"));if(o.video=o.isYouTube||r,o.playing=!1,o.isYouTube)o.playerReady=!1,o.posterLoaded=!1,l(o,i,t);else if("object"===e.type(i)&&i.hasOwnProperty("poster"))c(o,i,t);else{var n=i;if("object"===e.type(i)){var s,p={},y=[];for(s in i)i.hasOwnProperty(s)&&y.push(s);y.sort($.sortAsc);for(s in y)y.hasOwnProperty(s)&&(p[y[s]]={width:parseInt(y[s]),url:i[y[s]]});o.responsive=!0,o.sources=p,n=d(o)}u(o,n,!1,t)}}else o.$el.trigger(T.loaded)}function d(e){if(e.responsive)for(var i in e.sources)if(e.sources.hasOwnProperty(i)&&o.windowWidth>=e.sources[i].width)return e.sources[i].url;return e.source}function u(o,i,t,a){var r=[P.media,P.image,a!==!0?P.animated:""].join(" "),n=e('<div class="'+r+'"><img></div>'),s=n.find("img"),d=i;s.one(T.load,function(){C&&n.addClass(P["native"]).css({backgroundImage:"url('"+d+"')"}),n.fsTransition({property:"opacity"},function(){t||p(o)}).css({opacity:1}),g(o),(!t||a)&&o.$el.trigger(T.loaded)}).attr("src",d),o.responsive&&n.addClass(P.responsive),o.$container.append(n),(s[0].complete||4===s[0].readyState)&&s.trigger(T.load),o.currentSource=d}function c(i,t,a){if(i.source&&i.source.poster&&(u(i,i.source.poster,!0,!0),a=!1),!o.isMobile){var r=[P.media,P.video,a!==!0?P.animated:""].join(" "),n='<div class="'+r+'">';n+="<video",i.loop&&(n+=" loop"),i.mute&&(n+=" muted"),n+=">",i.source.webm&&(n+='<source src="'+i.source.webm+'" type="video/webm" />'),i.source.mp4&&(n+='<source src="'+i.source.mp4+'" type="video/mp4" />'),i.source.ogg&&(n+='<source src="'+i.source.ogg+'" type="video/ogg" />'),n+="</video>",n+="</div>";var s=e(n),d=s.find("video");d.one(T.loadedMetaData,function(e){s.fsTransition({property:"opacity"},function(){p(i)}).css({opacity:1}),g(i),i.$el.trigger(T.loaded),i.autoPlay&&f(i)}),i.$container.append(s)}}function l(i,t,a){if(!i.videoId){var r=t.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);i.videoId=r[1]}if(i.posterLoaded||(i.source.poster||(i.source.poster="http://img.youtube.com/vi/"+i.videoId+"/0.jpg"),i.posterLoaded=!0,u(i,i.source.poster,!0,a),a=!1),!o.isMobile)if(e("script[src*='youtube.com/iframe_api']").length||e("head").append('<script src="//www.youtube.com/iframe_api"></script>'),I){var n=i.guid+"_"+i.youTubeGuid++,s=[P.media,P.embed,a!==!0?P.animated:""].join(" "),d='<div class="'+s+'">';d+='<div id="'+n+'"></div>',d+="</div>";var c=e(d),l=e.extend(!0,{},{controls:0,rel:0,showinfo:0,wmode:"transparent",enablejsapi:1,version:3,playerapiid:n,loop:i.loop?1:0,autoplay:1,origin:Y.location.protocol+"//"+Y.location.host},i.youtubeOptions);i.$container.append(c),i.player&&(i.oldPlayer=i.player,i.player=null),i.player=new Y.YT.Player(n,{videoId:i.videoId,playerVars:l,events:{onReady:function(e){i.playerReady=!0,i.mute&&i.player.mute(),i.autoPlay&&i.player.playVideo()},onStateChange:function(e){i.playing||e.data!==Y.YT.PlayerState.PLAYING?i.loop&&i.playing&&e.data===Y.YT.PlayerState.ENDED&&i.player.playVideo():(i.playing=!0,i.autoPlay||i.player.pauseVideo(),c.fsTransition({property:"opacity"},function(){p(i)}).css({opacity:1}),g(i),i.$el.trigger(T.loaded)),i.$el.find(w.embed).addClass(P.ready)},onPlaybackQualityChange:function(e){},onPlaybackRateChange:function(e){},onError:function(e){},onApiChange:function(e){}}}),g(i)}else O.push({data:i,source:t})}function p(e){var o=e.$container.find(w.media);o.length>=1&&(o.not(":last").remove(),e.oldPlayer=null)}function y(e){var o=e.$container.find(w.media);o.length>=1&&o.fsTransition({property:"opacity"},function(){o.remove(),delete e.source}).css({opacity:0})}function h(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.pauseVideo();else{var o=e.$container.find("video");o.length&&o[0].pause()}e.playing=!1}}function f(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.playVideo();else{var o=e.$container.find("video");o.length&&o[0].play()}e.playing=!0}}function v(e){if(e.responsive){var o=d(e);o!==e.currentSource?u(e,o,!1,!0):g(e)}else g(e)}function g(e){for(var o=e.$container.find(w.media),i=0,t=o.length;t>i;i++){var a=o.eq(i),r=e.isYouTube?"iframe":a.find("video").length?"video":"img",n=a.find(r);if(n.length&&("img"!==r||!C)){var s=e.$el.outerWidth(),d=e.$el.outerHeight(),u=m(e,n);e.width=u.width,e.height=u.height,e.left=0,e.top=0;var c=e.isYouTube?e.embedRatio:e.width/e.height;e.height=d,e.width=e.height*c,e.width<s&&(e.width=s,e.height=e.width/c),e.left=-(e.width-s)/2,e.top=-(e.height-d)/2,a.css({height:e.height,width:e.width,left:e.left,top:e.top})}}}function m(o,i){if(o.isYouTube)return{height:500,width:500/o.embedRatio};if(i.is("img")){var t=i[0];if("undefined"!==e.type(t.naturalHeight))return{height:t.naturalHeight,width:t.naturalWidth};var a=new Image;return a.src=t.src,{height:a.height,width:a.width}}return{height:i[0].videoHeight,width:i[0].videoWidth}}var b=o.Plugin("background",{widget:!0,defaults:{autoPlay:!0,customClass:"",embedRatio:1.777777,loop:!0,mute:!0,source:null,youtubeOptions:{}},classes:["container","media","animated","responsive","native","fixed","ready"],events:{loaded:"loaded",ready:"ready",loadedMetaData:"loadedmetadata"},methods:{_construct:r,_destruct:n,_resize:t,play:f,pause:h,resize:g,load:s,unload:y}}),w=b.classes,P=w.raw,T=b.events,$=b.functions,Y=o.window,j=[],C="backgroundSize"in o.document.documentElement.style,I=!1,O=[];Y.onYouTubeIframeAPIReady=function(){I=!0;for(var e in O)O.hasOwnProperty(e)&&l(O[e].data,O[e].source);O=[]}}(jQuery,Formstone);